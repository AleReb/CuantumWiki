<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="CuantumWiki ‚Äî Wiki t√©cnica para detecci√≥n de tono con arquitectura distribuida: Web, ESP32-S3 coordinador y 4x ESP32-C3 workers TinyML.">
  <title>CuantumWiki ‚Äî Arquitectura Distribuida de Detecci√≥n de Tono</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öõ</text></svg>">
</head>

<body>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <header class="header">
    <button class="menu-toggle" aria-label="Menu">‚ò∞</button>
    <a href="#inicio" class="header-logo">
      <div class="logo-icon">‚öõ</div>
      <h1>CuantumWiki</h1>
    </a>
    <span class="header-subtitle">Wiki T√©cnica ‚Äî Detecci√≥n de Tono Distribuida</span>
    <div class="header-right">
      <span class="header-badge"><span class="dot"></span> v3.0</span>
    </div>
  </header>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <nav class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-section-title">General</div>
      <a href="#inicio" class="nav-link active">
        <span class="nav-icon">üè†</span> Inicio
      </a>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-section-title">Documentaci√≥n</div>
      <a href="#arquitectura" class="nav-link">
        <span class="nav-icon">üèóÔ∏è</span> Arquitectura
        <span class="nav-num">01</span>
      </a>
      <a href="#protocolo" class="nav-link">
        <span class="nav-icon">üîå</span> Protocolo Serial
        <span class="nav-num">02</span>
      </a>
      <a href="#modelo" class="nav-link">
        <span class="nav-icon">üß†</span> Estrategia de Modelo
        <span class="nav-num">03</span>
      </a>
      <a href="#firmware" class="nav-link">
        <span class="nav-icon">‚öôÔ∏è</span> Plan de Firmware
        <span class="nav-num">04</span>
      </a>
      <a href="#web-tokenizer" class="nav-link">
        <span class="nav-icon">üåê</span> Web + Tokenizaci√≥n
        <span class="nav-num">05</span>
      </a>
      <a href="#orquestacion" class="nav-link">
        <span class="nav-icon">üîÑ</span> Orquestaci√≥n
        <span class="nav-num">06</span>
      </a>
      <a href="#roadmap" class="nav-link">
        <span class="nav-icon">üó∫Ô∏è</span> Roadmap
        <span class="nav-num">07</span>
      </a>
      <a href="#github" class="nav-link">
        <span class="nav-icon">üì¶</span> GitHub Collab
        <span class="nav-num">08</span>
      </a>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-section-title">Referentes</div>
      <a href="#ref-master" class="nav-link">
        <span class="nav-icon">üî∑</span> masterV3 (S3)
      </a>
      <a href="#ref-quantum" class="nav-link">
        <span class="nav-icon">üî∂</span> quantumV3 (C3)
      </a>
      <a href="#ref-comparativa" class="nav-link">
        <span class="nav-icon">üìä</span> Comparativa
      </a>
    </div>
  </nav>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <main class="main">

    <!-- ‚îÄ‚îÄ‚îÄ INICIO ‚îÄ‚îÄ‚îÄ -->
    <section id="inicio" class="section">
      <div class="hero">
        <h1>CuantumWiki</h1>
        <p class="hero-description">
          Wiki t√©cnico para el proyecto de detecci√≥n de tono con arquitectura distribuida.
          Tokenizaci√≥n en PC, coordinaci√≥n por ESP32-S3, clasificaci√≥n TinyML en nodos ESP32-C3.
        </p>
        <div class="hero-stats">
          <div class="stat">
            <span class="stat-value">3</span>
            <span class="stat-label">Capas</span>
          </div>
          <div class="stat">
            <span class="stat-value">4</span>
            <span class="stat-label">Workers C3</span>
          </div>
          <div class="stat">
            <span class="stat-value">5</span>
            <span class="stat-label">Clases de Tono</span>
          </div>
          <div class="stat">
            <span class="stat-value">&lt;80ms</span>
            <span class="stat-label">Latencia Objetivo</span>
          </div>
        </div>
      </div>

      <div class="flow-diagram">
        <div class="flow-node">
          <div class="node-label">üåê Web App</div>
          <div class="node-sub">Tokenizaci√≥n + UI</div>
        </div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-node">
          <div class="node-label">üì° Serial</div>
          <div class="node-sub">JSONL</div>
        </div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-node">
          <div class="node-label">üî∑ ESP32-S3</div>
          <div class="node-sub">Coordinator</div>
        </div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-node">
          <div class="node-label">üî∂ ESP32-C3 √ó4</div>
          <div class="node-sub">TinyML Workers</div>
        </div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-node">
          <div class="node-label">üìä Resultado</div>
          <div class="node-sub">label + confianza</div>
        </div>
      </div>

      <div class="alert info">
        <strong>Objetivo:</strong> Detectar tono/intenci√≥n de mensajes de texto con baja latencia, usando tokenizaci√≥n
        en PC y clasificaci√≥n liviana en nodos ESP32.
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ 01 ARQUITECTURA ‚îÄ‚îÄ‚îÄ -->
    <section id="arquitectura" class="section">
      <div class="section-header">
        <div class="section-number">01 ‚Äî Documentaci√≥n</div>
        <h2>Arquitectura del Sistema</h2>
      </div>

      <div class="arch-grid">
        <div class="card">
          <div class="card-header">
            <div class="card-icon purple">üåê</div>
            <div>
              <div class="card-title">Web App (PC)</div>
              <div class="card-subtitle">Frontend + Procesamiento</div>
            </div>
          </div>
          <ul>
            <li>Entrada de texto del usuario</li>
            <li>Tokenizaci√≥n del mensaje</li>
            <li>Preprocesamiento y empaquetado</li>
            <li>Visualizaci√≥n de resultados</li>
          </ul>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon cyan">üî∑</div>
            <div>
              <div class="card-title">ESP32-S3 (Coordinator)</div>
              <div class="card-subtitle">Master I2C + Serial Bridge</div>
            </div>
          </div>
          <ul>
            <li>Conexi√≥n Serial con la Web</li>
            <li>Enrutamiento de tareas a nodos C3</li>
            <li>Agregaci√≥n de resultados</li>
            <li>Health checks de nodos</li>
          </ul>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon green">üî∂</div>
            <div>
              <div class="card-title">4√ó ESP32-C3 (Workers)</div>
              <div class="card-subtitle">Inferencia TinyML</div>
            </div>
          </div>
          <ul>
            <li>Inferencia Neuronal Nativa (Math en C puro, sin TFLite)</li>
            <li>Respuesta con clase + confianza + latencia</li>
            <li>Operaci√≥n aut√≥noma por nodo</li>
          </ul>
        </div>
      </div>

      <h3>Principios de Dise√±o</h3>
      <ul>
        <li>El texto crudo se procesa en PC ‚Äî microcontroladores reciben solo tensores/features compactas.</li>
        <li>El S3 desacopla frontend del cl√∫ster de workers.</li>
        <li>Arquitectura no-bloqueante en todo el firmware.</li>
      </ul>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ 02 PROTOCOLO SERIAL ‚îÄ‚îÄ‚îÄ -->
    <section id="protocolo" class="section">
      <div class="section-header">
        <div class="section-number">02 ‚Äî Documentaci√≥n</div>
        <h2>Protocolo Serial (Web ‚Üî S3)</h2>
      </div>

      <p>Formato recomendado: <strong>JSON Lines</strong> (<code>\n</code> por mensaje).</p>

      <h3>Mensajes Web ‚Üí S3</h3>
      <pre><code>{
  "type": "infer",
  "req_id": "r-001",
  "model": "tone-v1",
  "tokens": [12, 45, 77],
  "max_len": 64,
  "route": "auto"
}</code></pre>

      <table>
        <thead>
          <tr>
            <th>Campo</th>
            <th>Descripci√≥n</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>req_id</code></td>
            <td>ID √∫nico de solicitud</td>
          </tr>
          <tr>
            <td><code>tokens</code></td>
            <td>input_ids ya tokenizados/padded</td>
          </tr>
          <tr>
            <td><code>max_len</code></td>
            <td>Longitud fija de entrada</td>
          </tr>
          <tr>
            <td><code>route</code></td>
            <td><code>auto</code> | <code>node_id</code></td>
          </tr>
        </tbody>
      </table>

      <h3>Mensajes S3 ‚Üí Web</h3>
      <h4>Resultado exitoso</h4>
      <pre><code>{
  "type": "result",
  "req_id": "r-001",
  "label": "neutral",
  "confidence": 0.91,
  "node": "c3-2",
  "latency_ms": 38
}</code></pre>

      <h4>Error</h4>
      <pre><code>{
  "type": "error",
  "req_id": "r-001",
  "code": "NODE_TIMEOUT",
  "message": "worker no respondi√≥"
}</code></pre>

      <h3>Reglas</h3>
      <ul>
        <li>Timeout inferencia por nodo: <strong>300‚Äì800 ms</strong></li>
        <li>Reintento: <strong>1</strong></li>
        <li>Si falla nodo asignado: <strong>reroute autom√°tico</strong></li>
      </ul>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ 03 MODELO ‚îÄ‚îÄ‚îÄ -->
    <section id="modelo" class="section">
      <div class="section-header">
        <div class="section-number">03 ‚Äî Documentaci√≥n</div>
        <h2>Estrategia de Modelo (Tono)</h2>
      </div>

      <h3>Etiquetas de clasificaci√≥n</h3>
      <div style="margin-bottom: 16px;">
        <span class="tag green">neutral</span>
        <span class="tag cyan">positivo</span>
        <span class="tag amber">urgente</span>
        <span class="tag red">molesto</span>
        <span class="tag purple">formal</span>
      </div>

      <h3>Restricciones ESP32-C3</h3>
      <ul>
        <li>Implementaci√≥n matem√°tica manual en C (sin dependencias ML externas)</li>
        <li>Input fijo (64 tokens por inferencia)</li>
        <li>L√≠mite de Flash (~1.3MB en weights, 55% del espacio total)</li>
      </ul>

      <h3>Pipeline de Entrenamiento</h3>
      <ol>
        <li>Descarga de HuggingFace + limpieza Regex (URLs, @)</li>
        <li>Tokenizaci√≥n basada en frecuencias (Vocab: 3500)</li>
        <li>Entrenamiento de Embedding + Dense en PC (Keras)</li>
        <li>Exportar pesos crudos (`float32`) a un Header en C (`.h`)</li>
      </ol>

      <h3>M√©tricas M√≠nimas</h3>
      <table>
        <thead>
          <tr>
            <th>M√©trica</th>
            <th>Objetivo</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Accuracy macro</td>
            <td>‚â• 80% (inicio)</td>
          </tr>
          <tr>
            <td>Latencia por nodo</td>
            <td>‚â§ 80 ms</td>
          </tr>
          <tr>
            <td>Memoria</td>
            <td>Estable sin resets</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ 04 FIRMWARE ‚îÄ‚îÄ‚îÄ -->
    <section id="firmware" class="section">
      <div class="section-header">
        <div class="section-number">04 ‚Äî Documentaci√≥n</div>
        <h2>Plan de Firmware</h2>
      </div>

      <div class="chip-compare">
        <div class="chip-card">
          <h4><span class="tag cyan">ESP32-S3</span> Coordinator</h4>
          <div class="chip-spec"><span class="spec-label">Parser</span><span class="spec-value">JSONL serial</span>
          </div>
          <div class="chip-spec"><span class="spec-label">Cola</span><span class="spec-value">Request queue</span></div>
          <div class="chip-spec"><span class="spec-label">Scheduler</span><span class="spec-value">Workers
              round-robin</span></div>
          <div class="chip-spec"><span class="spec-label">Monitor</span><span class="spec-value">ping, last_seen,
              error_rate</span></div>
          <div class="chip-spec"><span class="spec-label">Logs</span><span class="spec-value">Enrutamiento +
              errores</span></div>
        </div>
        <div class="chip-card">
          <h4><span class="tag green">ESP32-C3</span> Worker</h4>
          <div class="chip-spec"><span class="spec-label">Init</span><span class="spec-value">Matriz flotante
              auto-generada</span></div>
          <div class="chip-spec"><span class="spec-label">Recibir</span><span class="spec-value">Tokens int16 (binario
              I2C)</span></div>
          <div class="chip-spec"><span class="spec-label">Ejecutar</span><span class="spec-value">Inferencia C-Math
              pura</span></div>
          <div class="chip-spec"><span class="spec-label">Responder</span><span
              class="spec-value">label/confidence/latency</span></div>
          <div class="chip-spec"><span class="spec-label">Logs</span><span class="spec-value">Boot, infer ok/fail</span>
          </div>
        </div>
      </div>

      <h3>Versionado</h3>
      <ul>
        <li>API firmware: <code>fw_api_v1</code></li>
        <li>Modelo: <code>tone-vX</code></li>
      </ul>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ 05 WEB + TOKENIZACI√ìN ‚îÄ‚îÄ‚îÄ -->
    <section id="web-tokenizer" class="section">
      <div class="section-header">
        <div class="section-number">05 ‚Äî Documentaci√≥n</div>
        <h2>Web + Tokenizaci√≥n</h2>
      </div>

      <h3>Stack Sugerido</h3>
      <ul>
        <li><strong>Frontend:</strong> React/Vite (o simple HTML+JS)</li>
        <li><strong>Serial:</strong> Web Serial API</li>
        <li><strong>Tokenizaci√≥n:</strong> Librer√≠a JS (seg√∫n vocab del modelo)</li>
      </ul>

      <h3>Flujo UI</h3>
      <div class="flow-diagram">
        <div class="flow-node">
          <div class="node-label">‚úçÔ∏è Input</div>
          <div class="node-sub">Usuario escribe</div>
        </div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-node">
          <div class="node-label">üî§ Tokenizar</div>
          <div class="node-sub">+ padding</div>
        </div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-node">
          <div class="node-label">üì° Serial</div>
          <div class="node-sub">Enviar infer</div>
        </div>
        <span class="flow-arrow">‚Üí</span>
        <div class="flow-node">
          <div class="node-label">üìä Resultado</div>
          <div class="node-sub">confianza + nodo + ms</div>
        </div>
      </div>

      <h3>Buenas Pr√°cticas</h3>
      <ul>
        <li>Cachear vocab/tokenizer en browser</li>
        <li>Validar longitud m√°xima de entrada</li>
        <li>Bot√≥n de reconnect serial</li>
      </ul>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ 06 ORQUESTACI√ìN ‚îÄ‚îÄ‚îÄ -->
    <section id="orquestacion" class="section">
      <div class="section-header">
        <div class="section-number">06 ‚Äî Documentaci√≥n</div>
        <h2>Orquestaci√≥n Multi-Nodo</h2>
      </div>

      <h3>Estrategia Inicial</h3>
      <ul>
        <li><code>route=auto</code> con round-robin entre 4 C3</li>
        <li>Excluir nodos con timeout consecutivo</li>
        <li>Reintegrar nodos tras N pings exitosos</li>
      </ul>

      <h3>Modo Resiliente</h3>
      <div class="card">
        <div class="card-header">
          <div class="card-icon amber">üõ°Ô∏è</div>
          <div>
            <div class="card-title">Circuit Breaker por Nodo</div>
            <div class="card-subtitle">Resiliencia autom√°tica</div>
          </div>
        </div>
        <ul>
          <li>Retry una vez en nodo alternativo</li>
          <li>Circuit breaker por nodo (abierto tras fallas consecutivas)</li>
          <li>Recovery autom√°tico tras pings exitosos</li>
        </ul>
      </div>

      <h3>Escalado</h3>
      <ul>
        <li>Soportar nuevos workers con registro din√°mico</li>
        <li>Tabla de capacidades por nodo (modelo soportado, versi√≥n)</li>
      </ul>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ 07 ROADMAP ‚îÄ‚îÄ‚îÄ -->
    <section id="roadmap" class="section">
      <div class="section-header">
        <div class="section-number">07 ‚Äî Documentaci√≥n</div>
        <h2>Roadmap de Implementaci√≥n</h2>
      </div>

      <div class="roadmap-phase">
        <div class="roadmap-dot active"></div>
        <h4>Fase 1 ‚Äî MVP</h4>
        <div class="roadmap-item"><span class="checkbox">‚òê</span> Protocolo serial operativo</div>
        <div class="roadmap-item"><span class="checkbox">‚òê</span> 1 C3 corriendo inferencia</div>
        <div class="roadmap-item"><span class="checkbox">‚òê</span> Web muestra resultados b√°sicos</div>
      </div>

      <div class="roadmap-phase">
        <div class="roadmap-dot"></div>
        <h4>Fase 2 ‚Äî Multi-nodo</h4>
        <div class="roadmap-item"><span class="checkbox">‚òê</span> 4 C3 en round-robin</div>
        <div class="roadmap-item"><span class="checkbox">‚òê</span> M√©tricas de latencia por nodo</div>
        <div class="roadmap-item"><span class="checkbox">‚òê</span> Manejo robusto de errores</div>
      </div>

      <div class="roadmap-phase">
        <div class="roadmap-dot active"></div>
        <h4>Fase 3 ‚Äî Producci√≥n Alerta</h4>
        <div class="roadmap-item"><span class="checkbox">‚úÖ</span> Modelo ampliado 1.3MB sin sesgos de longitud</div>
        <div class="roadmap-item"><span class="checkbox">‚úÖ</span> Panel de monitoreo Web responsivo</div>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ 08 GITHUB ‚îÄ‚îÄ‚îÄ -->
    <section id="github" class="section">
      <div class="section-header">
        <div class="section-number">08 ‚Äî Documentaci√≥n</div>
        <h2>GitHub para Trabajo Multi-PC</h2>
      </div>

      <h3>Setup Inicial</h3>
      <pre><code>cd C:\CuantumWiki
git init
git add .
git commit -m "init: arquitectura CuantumWiki"
git branch -M main
git remote add origin &lt;URL_DEL_REPO&gt;
git push -u origin main</code></pre>

      <h3>Flujo Diario</h3>
      <pre><code>git pull --rebase
git add .
git commit -m "update: ..."
git push</code></pre>

      <h3>Convenci√≥n de Ramas</h3>
      <table>
        <thead>
          <tr>
            <th>Rama</th>
            <th>Prop√≥sito</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>main</code></td>
            <td>Estable</td>
          </tr>
          <tr>
            <td><code>dev</code></td>
            <td>Integraci√≥n</td>
          </tr>
          <tr>
            <td><code>feat/*</code></td>
            <td>Features puntuales</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê REFERENTES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- ‚îÄ‚îÄ‚îÄ REF: masterV3 ‚îÄ‚îÄ‚îÄ -->
    <section id="ref-master" class="section">
      <div class="section-header">
        <div class="section-number">Referente ‚Äî ESP32-S3</div>
        <h2>masterV3.ino ‚Äî Coordinator</h2>
      </div>

      <div class="alert info">
        <strong>977 l√≠neas</strong> ‚Äî Firmware master para ESP32-S3 con I2C, OLED, RTC, SD, BME280, NeoPixel y control
        serial bidireccional desde PC.
      </div>

      <h3>Resumen de Arquitectura</h3>
      <table>
        <thead>
          <tr>
            <th>Aspecto</th>
            <th>Detalle</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Rol</td>
            <td>Master I2C, coordinador de 4 slaves ESP32-C3</td>
          </tr>
          <tr>
            <td>Perif√©ricos</td>
            <td>OLED SH1106, RTC DS3231, SD (HSPI), BME280, NeoPixel, 2 botones</td>
          </tr>
          <tr>
            <td>I2C TX</td>
            <td><code>T,&lt;tick&gt;,&lt;mode&gt;,&lt;noise&gt;\n</code></td>
          </tr>
          <tr>
            <td>I2C TX (params)</td>
            <td><code>P,&lt;noise&gt;,&lt;bias&gt;,&lt;kp&gt;,&lt;mode&gt;\n</code></td>
          </tr>
          <tr>
            <td>Serial PC</td>
            <td><code>@HELLO</code>, <code>@SET</code>, <code>@PARAM</code>, <code>@GET</code>, <code>@STOP</code></td>
          </tr>
          <tr>
            <td>Batch output</td>
            <td>
              <code>O,&lt;tick&gt;,&lt;slaveIdx&gt;,&lt;bmask&gt;,&lt;loss&gt;,&lt;noise&gt;,&lt;seed&gt;,&lt;fmt&gt;</code>
            </td>
          </tr>
          <tr>
            <td>Arquitectura</td>
            <td>Non-blocking scheduler, flags de estado, retry autom√°tico</td>
          </tr>
          <tr>
            <td>Logging</td>
            <td>CSV en SD con timestamp, m√©tricas, par√°metros</td>
          </tr>
          <tr>
            <td>Display</td>
            <td>OLED con barra de reconstrucci√≥n, grid de slaves, historial gr√°fico</td>
          </tr>
        </tbody>
      </table>

      <h3>Pines y Configuraci√≥n Hardware</h3>
      <table>
        <thead>
          <tr>
            <th>Componente</th>
            <th>Pines</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Bot√≥n A</td>
            <td>GPIO 1</td>
          </tr>
          <tr>
            <td>Bot√≥n B</td>
            <td>GPIO 2</td>
          </tr>
          <tr>
            <td>NeoPixel</td>
            <td>GPIO 48</td>
          </tr>
          <tr>
            <td>SD CS</td>
            <td>GPIO 7</td>
          </tr>
          <tr>
            <td>SD MOSI</td>
            <td>GPIO 6</td>
          </tr>
          <tr>
            <td>SD MISO</td>
            <td>GPIO 4</td>
          </tr>
          <tr>
            <td>SD SCLK</td>
            <td>GPIO 5</td>
          </tr>
          <tr>
            <td>I2C</td>
            <td>Default (SDA/SCL)</td>
          </tr>
        </tbody>
      </table>

      <h3>Slaves I2C</h3>
      <pre><code>static constexpr uint8_t SLAVE_ADDRESSES[] = { 0x10, 0x11, 0x12, 0x13 };
static constexpr uint8_t NUM_SLAVES = 4;</code></pre>

      <h3>Protocolo Serial (PC ‚Üí Master)</h3>
      <pre><code>// Handshake
@HELLO
‚Üí @HELLO OK FW=MasterV3Full SLAVES=4

// Set par√°metros locales
@SET N=0.20 M=1
‚Üí @ACK SET N=0.20 M=1

// Broadcast par√°metros a slaves
@PARAM N=0.20 B=5 K=60 M=1
‚Üí @ACK PARAM N=0.20 B=5 K=60 M=1

// Iniciar batch de mediciones
@GET K=200 STRIDE=1 BURN=20
‚Üí @BATCH K=200 STRIDE=1 BURN=20 N=0.20 M=1 B=0 Kp=0
‚Üí O,&lt;tick&gt;,&lt;slaveIdx&gt;,&lt;bmask&gt;,&lt;loss&gt;,&lt;noise&gt;,&lt;seed&gt;,&lt;fmt&gt;  (√óK)
‚Üí @DONE LASTTICK=200

// Detener batch
@STOP
‚Üí @ACK STOP</code></pre>

      <h3>Modelo de Datos por Slave</h3>
      <pre><code>struct SlaveObs {
  uint32_t tick = 0;
  uint16_t bmask = 0;
  uint16_t loss = 0;
  float noise = NAN;
  uint8_t noiseByte = 0;
  uint32_t seed = 0;
  uint8_t fmt = 0;      // 0=invalid, 1=long, 2=compact
  bool valid = false;
  uint32_t lastRxMs = 0;
};</code></pre>

      <h3>Componentes Reutilizables para Detecci√≥n de Tono</h3>
      <div class="card">
        <div class="card-header">
          <div class="card-icon green">‚úÖ</div>
          <div>
            <div class="card-title">Reutilizables directamente</div>
          </div>
        </div>
        <ul>
          <li>Non-blocking scheduler y timing</li>
          <li>Init con flags + retry autom√°tico</li>
          <li>OLED display framework</li>
          <li>SD logging con timestamp</li>
          <li>Health check y reporte serial</li>
          <li>Debounce de botones</li>
          <li>NeoPixel status LED</li>
        </ul>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-icon amber">üîÑ</div>
          <div>
            <div class="card-title">Requieren adaptaci√≥n</div>
          </div>
        </div>
        <ul>
          <li>Protocolo serial PC: cambiar de <code>@</code> commands a <strong>JSONL</strong></li>
          <li>Protocolo I2C: cambiar observables por tokens/features de entrada y label/confidence de respuesta</li>
          <li><code>SlaveObs</code>: reemplazar por estructura de resultado de inferencia</li>
          <li>Batch driver: adaptar para requests de inferencia</li>
          <li>Bulk reconstruction: eliminar (espec√≠fico de toy holography)</li>
        </ul>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ REF: quantumV3 ‚îÄ‚îÄ‚îÄ -->
    <section id="ref-quantum" class="section">
      <div class="section-header">
        <div class="section-number">Referente ‚Äî ESP32-C3</div>
        <h2>quantumV3.ino ‚Äî Boundary Node (Worker)</h2>
      </div>

      <div class="alert info">
        <strong>333 l√≠neas</strong> ‚Äî Nodo worker I2C slave con simulaci√≥n LFSR de estado cu√°ntico. Base para los
        workers TinyML de detecci√≥n de tono.
      </div>

      <h3>Resumen de Arquitectura</h3>
      <table>
        <thead>
          <tr>
            <th>Aspecto</th>
            <th>Detalle</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Rol</td>
            <td>I2C slave, worker de simulaci√≥n</td>
          </tr>
          <tr>
            <td>Address</td>
            <td>Configurable: <code>0x10</code>, <code>0x11</code>, <code>0x12</code>, <code>0x13</code></td>
          </tr>
          <tr>
            <td>I2C RX</td>
            <td>Parsea <code>T,&lt;tick&gt;,&lt;mode&gt;,&lt;noise&gt;</code> y
              <code>P,&lt;noise&gt;,&lt;bias&gt;,&lt;kp&gt;,&lt;mode&gt;</code></td>
          </tr>
          <tr>
            <td>I2C TX</td>
            <td>Formato compacto: <code>O,%08lX,%04X,%04X,%02X\n</code> (‚â§ 32 bytes)</td>
          </tr>
          <tr>
            <td>LED</td>
            <td>Pin 7, pulso visual por interacci√≥n I2C</td>
          </tr>
          <tr>
            <td>Din√°mica</td>
            <td>LFSR-16 + xorshift32 PRNG</td>
          </tr>
          <tr>
            <td>Scheduler</td>
            <td>Non-blocking 20ms steps + health print 3s</td>
          </tr>
        </tbody>
      </table>

      <h3>Configuraci√≥n</h3>
      <pre><code>#define SLAVE_ADDRESS 0x10  // CAMBIAR POR NODO: 0x10, 0x11, 0x12, 0x13

static constexpr int LED_PIN = 7;
static constexpr uint8_t I2C_MAX_RX = 32;
static constexpr uint32_t WORK_STEP_PERIOD_MS = 20;
static constexpr uint32_t HEALTH_PRINT_MS = 3000;
static constexpr uint16_t LED_PULSE_MS = 30;</code></pre>

      <h3>Callbacks I2C</h3>
      <pre><code>// Recepci√≥n (desde Master)
static void onReceiveEvent(int howMany) {
  // Lee bytes en rxBuf, marca cmdPending = true
}

// Solicitud (Master pide datos)
static void onRequestEvent() {
  // Env√≠a txBuf al master
  Wire.write(txBuf, strnlen(txBuf, sizeof(txBuf)));
}</code></pre>

      <h3>Formato de Respuesta Compacta</h3>
      <pre><code>// "O,%08lX,%04X,%04X,%02X\n" ‚Üí 26 chars m√°ximo
// tickHex(32bit), bmask(16), loss(16), noiseByte(0..255)
snprintf(txBuf, sizeof(txBuf),
  "O,%08lX,%04X,%04X,%02X\n",
  currentTick, bmask, lossCount, noiseByte);</code></pre>

      <h3>Componentes Reutilizables para Detecci√≥n de Tono</h3>
      <div class="card">
        <div class="card-header">
          <div class="card-icon green">‚úÖ</div>
          <div>
            <div class="card-title">Reutilizables directamente</div>
          </div>
        </div>
        <ul>
          <li>Esqueleto I2C slave con <code>onReceive</code> / <code>onRequest</code></li>
          <li>Non-blocking loop con scheduler</li>
          <li>LED pulse feedback</li>
          <li>Health print peri√≥dico</li>
          <li>Init con retry y flags</li>
          <li>Buffer management (rxBuf/txBuf ‚â§ 32 bytes)</li>
        </ul>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-icon amber">üîÑ</div>
          <div>
            <div class="card-title">Requieren adaptaci√≥n</div>
          </div>
        </div>
        <ul>
          <li><code>updateBoundaryState()</code>: reemplazar LFSR/PRNG con <strong>inferencia matem√°tica en C
              puro</strong> (sin TFLite)</li>
          <li><code>buildResponseCompact()</code>: reemplazar con <strong>resultado textual/CSV</strong> (label,
            confidence, latency)</li>
          <li>Parsers: adaptar para recibir <strong>tokens/features</strong> compactas en vez de tick/noise</li>
          <li>El formato compacto de 32 bytes puede necesitar expandirse para el resultado de inferencia</li>
        </ul>
      </div>
    </section>

    <!-- ‚îÄ‚îÄ‚îÄ REF: COMPARATIVA ‚îÄ‚îÄ‚îÄ -->
    <section id="ref-comparativa" class="section">
      <div class="section-header">
        <div class="section-number">Referente ‚Äî An√°lisis</div>
        <h2>Comparativa: Referentes vs Plan CuantumWiki</h2>
      </div>

      <table>
        <thead>
          <tr>
            <th>Caracter√≠stica</th>
            <th>masterV3 / quantumV3 (Actual)</th>
            <th>CuantumWiki (Objetivo)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Protocolo PC‚ÜîS3</td>
            <td>Comandos <code>@</code> custom (SET, GET, STOP)</td>
            <td>JSONL (<code>infer</code>, <code>result</code>, <code>error</code>)</td>
          </tr>
          <tr>
            <td>Protocolo S3‚ÜîC3</td>
            <td>I2C texto: <code>T,tick,mode,noise</code></td>
            <td>I2C binario/texto con tokens compactos</td>
          </tr>
          <tr>
            <td>Tarea del worker</td>
            <td>Simulaci√≥n LFSR (boundary state)</td>
            <td>Inferencia neuronal C-Math Float32</td>
          </tr>
          <tr>
            <td>Output del worker</td>
            <td><code>O,tick,bmask,loss,noise</code></td>
            <td><code>label, confidence, latency_ms</code></td>
          </tr>
          <tr>
            <td>Scheduler</td>
            <td>Non-blocking ‚úÖ</td>
            <td>Non-blocking ‚úÖ (reutilizable)</td>
          </tr>
          <tr>
            <td>Health checks</td>
            <td>Peri√≥dicos + serial report</td>
            <td>Peri√≥dicos + <code>ping/last_seen/error_rate</code></td>
          </tr>
          <tr>
            <td>Routing</td>
            <td>Broadcast a todos</td>
            <td>Round-robin / route=auto / node_id</td>
          </tr>
          <tr>
            <td>Error handling</td>
            <td>Parse fail ‚Üí ignore</td>
            <td>Retry + circuit breaker + reroute</td>
          </tr>
          <tr>
            <td>Frontend</td>
            <td>PC serial monitor</td>
            <td>Web App con Web Serial API</td>
          </tr>
          <tr>
            <td>Perif√©ricos S3</td>
            <td>OLED, RTC, SD, BME280, NeoPixel</td>
            <td>Mismos (reutilizables)</td>
          </tr>
        </tbody>
      </table>

      <div class="alert success">
        <strong>Conclusi√≥n:</strong> La base de c√≥digo de los referentes es s√≥lida. El ~60% del c√≥digo del master
        (scheduler, init, OLED, SD, health, botones) y el ~50% del worker (I2C skeleton, loop, LED, buffers) son
        reutilizables directamente. Las adaptaciones principales son: cambiar el protocolo a JSONL, reemplazar la
        simulaci√≥n LFSR por TFLite Micro, y agregar l√≥gica de routing inteligente.
      </div>

      <h3>Pr√≥ximas Acciones</h3>
      <ol>
        <li>Definir etiquetas finales de tono (3‚Äì7 clases)</li>
        <li>Definir tokenizer exacto y <code>max_len</code></li>
        <li>Implementar protocolo serial JSONL en S3</li>
        <li>Levantar primer worker C3 con modelo dummy</li>
        <li>Integrar web con env√≠o/recepci√≥n serial</li>
        <li>Crear repo GitHub y subir este wiki</li>
      </ol>
    </section>

  </main>

  <script src="script.js"></script>
</body>

</html>